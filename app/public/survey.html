<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Survey Page</title>

    <!-- Latest compiled and minified CSS & JS -->

    <!-- <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB" crossorigin="anonymous">
    <script
    src="https://code.jquery.com/jquery-3.3.1.min.js"
    integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
    crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js" integrity="sha384-smHYKdLADwkXOn1EmN1qk/HfnUcbVRZyYmZ4qpPea6sjB/pTJ0euyQp0Mk8ck+5T" crossorigin="anonymous"></script> -->

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>


</head>

<body>

    <div class="container">

        <div class="jumbotron">
            <h2>Survey Questions</h2>
            <hr>
            <br>

            <div class="row">
                <div class="col-lg-12">

                    <!-- Reservation Page -->
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <h3 class="panel-heading">About You</h3>
                        </div>
                        <div class="panel-body">

                            <form role="form">

                                <div class="form-group">
                                    <label for="reserve-name">Name (Required)</label>
                                    <input type="text" class="form-control" id="friend-name">
                                </div>

                                <div class="form-group">
                                    <label for="reserve-phone">Link to Photo (Required)</label>
                                    <input type="text" class="form-control" id="friend-photo">
                                    <hr>
                                </div>
                                <div class="form-group">
                                    <h3 class="panel-heading">Question 1</h3>
                                    <label for="exampleFormControlSelect1">Your mind is always buzzing with unexplored ideas and plans.</label>
                                    <select class="form-control survey-number">
                                        <option>1 (Strongly Disagree)</option>
                                        <option>2</option>
                                        <option>3</option>
                                        <option>4</option>
                                        <option>5 (Strongly Agree)</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <h3 class="panel-heading">Question 2</h3>
                                    <label for="exampleFormControlSelect1">Generally speaking, you rely more on your experience than your imagination.</label>
                                    <select class="form-control survey-number">
                                        <option>1 (Strongly Disagree)</option>
                                        <option>2</option>
                                        <option>3</option>
                                        <option>4</option>
                                        <option>5 (Strongly Agree)</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <h3 class="panel-heading">Question 3</h3>
                                    <label for="exampleFormControlSelect1">You find it easy to stay relaxed and focused even when there is some pressure.</label>
                                    <select class="form-control survey-number">
                                        <option>1 (Strongly Disagree)</option>
                                        <option>2</option>
                                        <option>3</option>
                                        <option>4</option>
                                        <option>5 (Strongly Agree)</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <h3 class="panel-heading">Question 4</h3>
                                    <label for="exampleFormControlSelect1">You rarely do something just out of sheer curiosity.</label>
                                    <select class="form-control survey-number">
                                        <option>1 (Strongly Disagree)</option>
                                        <option>2</option>
                                        <option>3</option>
                                        <option>4</option>
                                        <option>5 (Strongly Agree)</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <h3 class="panel-heading">Question 5</h3>
                                    <label for="exampleFormControlSelect1">People can rarely upset you.</label>
                                    <select class="form-control survey-number">
                                        <option>1 (Strongly Disagree)</option>
                                        <option>2</option>
                                        <option>3</option>
                                        <option>4</option>
                                        <option>5 (Strongly Agree)</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <h3 class="panel-heading">Question 6</h3>
                                    <label for="exampleFormControlSelect1">It is often difficult for you to relate to other people’s feelings.</label>
                                    <select class="form-control survey-number">
                                        <option>1 (Strongly Disagree)</option>
                                        <option>2</option>
                                        <option>3</option>
                                        <option>4</option>
                                        <option>5 (Strongly Agree)</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <h3 class="panel-heading">Question 7</h3>
                                    <label for="exampleFormControlSelect1">In a discussion, truth should be more important than people’s sensitivities.</label>
                                    <select class="form-control survey-number">
                                        <option>1 (Strongly Disagree)</option>
                                        <option>2</option>
                                        <option>3</option>
                                        <option>4</option>
                                        <option>5 (Strongly Agree)</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <h3 class="panel-heading">Question 8</h3>
                                    <label for="exampleFormControlSelect1">You rarely get carried away by fantasies and ideas.</label>
                                    <select class="form-control survey-number">
                                        <option>1 (Strongly Disagree)</option>
                                        <option>2</option>
                                        <option>3</option>
                                        <option>4</option>
                                        <option>5 (Strongly Agree)</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <h3 class="panel-heading">Question 9</h3>
                                    <label for="exampleFormControlSelect1">You think that everyone’s views should be respected regardless of whether they are supported
                                        by facts or not.
                                    </label>
                                    <select class="form-control survey-number" id="9">
                                        <option>1 (Strongly Disagree)</option>
                                        <option>2</option>
                                        <option>3</option>
                                        <option>4</option>
                                        <option>5 (Strongly Agree)</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <h3 class="panel-heading">Question 10</h3>
                                    <label for="exampleFormControlSelect1">You feel more energetic after spending time with a group of people.</label>
                                    <select class="form-control survey-number" id="10">
                                        <option>1 (Strongly Disagree)</option>
                                        <option>2</option>
                                        <option>3</option>
                                        <option>4</option>
                                        <option>5 (Strongly Agree)</option>
                                    </select>
                                </div>
                                <br>
                                <button type="button" data-toggle="modal" data-target="#myModal" id="myButton" class="btn btn-primary submit">Submit</button>
                            </form>

                        </div>
                    </div>

                </div>
            </div>


            <footer class="footer">
                <div class="container">
                    <p>
                        <a href="/api/survey">API Friends List</a> |
                        <a href="https://github.com/nsanta11/FriendFinder">GitHub Repo</a>
                    </p>
                </div>
            </footer>

            <div class="modal" tabindex="-1" role="dialog">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">Modal title</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <p id="body-text"></p>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                            <button type="button" class="btn btn-primary">Save changes</button>
                        </div>
                    </div>
                </div>
            </div>

        </div>

</body>

</html>

<script type="text/javascript">

    var scores = [];
    //console.log(classes);

   // var difference = [];

    $("#myButton").on("click", function (event) {
        console.log(difference)
        event.preventDefault();
        $('.modal').modal('show')
       
        var classesNodeList = document.querySelectorAll(".survey-number");
        var classes = Array.prototype.map.call(classesNodeList, function (element) {
            return element.value
        });
        
        var currentURL = window.location.origin;
        $.ajax({ url: currentURL + "/api/survey", method: "GET" })
            .then(function (currentData) {
                console.log(currentData);
            });
            
        var newClass = [];
        var newScore = [];
        for (var i = 0; i < 10; i++) {
            newClass[i] = classes[i].slice(0, 2);
            newScore[i] = parseInt(classes[i]);
            //console.log(newClass)
            //classes = parseInt(classes[i]);
        }
        
        // Here we grab the form elements
        var currentFriend = {
            friendName: $("#friend-name").val().trim(),
            friendPhoto: $("#friend-photo").val().trim(),
            scores: newScore,
        };

        console.log(currentFriend);
        //newScore = parseInt(newScore);
        console.log(parseInt(newScore));
       
        var sum = 0;
        var min = 0;
        var difference = [];
        var currentURL = window.location.origin;
        var newSum = 0 
        var user = []
        var index = 0 
        var name = [];
        var pic = [];
        
        $.ajax({ url: currentURL + "/api/survey", method: "POST", data: currentFriend })
            .then(function (allFriends) {
          
                console.log(allFriends);
                
                for (var i = 0; i < allFriends.length-1; i++) {
                    // sum += parseInt(newScore[i], 10);
                    // console.log(sum);
                    sum = 0;
                    var friendScores = allFriends[i].scores;
                    console.log(friendScores);
                    for (var j = 0; j < allFriends[i].scores.length; j++) {
                        sum += (parseInt(newScore[j])) - parseInt((allFriends[i].scores[j]))
                        newSum = Math.abs(sum); 
                        console.log(newSum);
                        }
                        difference.push(newSum);
                    }  
                            min = Math.min.apply(null, difference)
                            console.log(min);
                        
                            for (var i = 0; i < difference.length; i++) {
                                //min = 9999
                                if (min == difference[i]) {
                                    //min = difference[i]
                                    user[index] = i
                                    index = index + 1
                                }
                            }
                            console.log(difference)
                            console.log(user);
                            for (i = 0 ; i < user.length; i++){
                             name[i] = allFriends[user[i]].friendName
                             pic[i] = allFriends[user[i]].friendPhoto
                             $("#body-text").text("Your best friend match is: " + name + "\n\n")
                            }
                           // $("#body-text").text("Your best friend match is: " + name)
                            console.log(name) 
                            console.log(pic)
                            

            })
        
    

    });

</script>